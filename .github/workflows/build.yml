name: Update Code and Build

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: SSH Update
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SSH_HOST }}
        username: ${{ secrets.SSH_USERNAME }}
        password: ${{ secrets.SSH_PASSWORD }}
        # å¤šæ­¥éª¤æ‰§è¡Œè„šæœ¬ï¼ˆæ¨èä½¿ç”¨ç®¡é“ç¬¦å·ä¿æŒæ ¼å¼ï¼‰
        script: |
          echo "â–¶ï¸ 1.è¿›å…¥é¡¹ç›®ç›®å½•"
          cd /home/web/4agi.net
          
          echo "ğŸ”„ 2.æ›´æ–°ä»£ç ï¼ˆGit Pullï¼‰"
          git reset --hard HEAD
          git pull origin main
          
          echo "ğŸ”¨ 3.æ‰§è¡Œæ„å»º"
          sh build/build.sh

          echo "âœ… æ‰€æœ‰æ“ä½œå·²å®Œæˆ"
